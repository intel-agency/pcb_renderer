# LLM Plugin for PCB Renderer

Natural-language error explanations, fix suggestions, and design analysis for PCB Renderer exports.

## Quickstart

```bash
# install project with LLM extras
uv sync --extra llm

# render with LLM explanations (auto-generates export JSON if not provided)
uv run pcb-render boards/board_alpha.json -o out/alpha.svg --llm-explain

# or keep the export for review and run multiple modes
uv run pcb-render boards/board_alpha.json -o out/alpha.svg --export-json out/alpha.json --llm-explain --llm-suggest-fixes --llm-analyze

# run plugin directly on an export JSON
uv run llm_plugin explain out/alpha.json
uv run llm_plugin suggest-fixes out/alpha.json
uv run llm_plugin analyze out/alpha.json
```

## Backend selection

- `LLM_BACKEND=template` (default): deterministic template response, ideal for tests.
- `LLM_BACKEND=local`: placeholder stub for future on-device models.
- `LLM_BACKEND=http` or `openai`: uses OpenAI-compatible chat completions.
  - Set `OPENAI_API_KEY`.
  - Optional: `OPENAI_BASE_URL` or `LLM_API_BASE` and `OPENAI_MODEL` (default `gpt-4o-mini`).

## What the plugin consumes

- Export JSON generated by core CLI `_build_export_payload` containing:
  - `parse_result`: success flag, errors, normalized board JSON, stats.
  - `validation_result`: errors with context, checks_run, counts.
  - `render_result`: success flag, output path/format.

## Commands (Typer CLI)

- `explain <export.json>`: summarize validation errors in plain language.
- `suggest-fixes <export.json>`: propose concrete JSON edits based on errors and board context.
- `analyze <export.json>`: share design insights from stats (area, density, trace length, vias).

## Notes

- The core CLI auto-registers plugin flags when `llm_plugin` is installed in the environment.
- When LLM flags are used without `--export-json`, a temporary export is created and passed to the plugin.
- Rendering is headless (Matplotlib Agg) for CI compatibility.
